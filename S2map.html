<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>899 Events S2 Map</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="S2mapstyle.css">
</head>
<body class="sidebar-active">
    <div id="map-container">
        <div id="map-grid">
            </div>
    </div>

    <div id="sidebar-button-dock">
         <button class="btn btn-secondary" id="sidebar-toggle" type="button" title="Toggle Alliance Summary & Buttons">
            <i class="fa-solid fa-chevron-right"></i>
            <span class="button-text">Toggle</span>
        </button>
        <div id="action-buttons-container">
            <button class="btn btn-warming" id="info-button" type="button" title="Information & Donate" data-bs-toggle="modal" data-bs-target="#infoModal">
                <i class="fa-solid fa-circle-info"></i>
                 <span class="button-text">Info</span>
            </button>
            <button class="btn btn-dark" id="import-map-button" type="button" title="Import Map Data from Code">
                <i class="fa-solid fa-file-import"></i>
                 <span class="button-text">Import</span>
            </button>
            <button class="btn btn-dark" id="export-map-button" type="button" title="Export Map Data as Code">
                <i class="fa-solid fa-file-export"></i>
                 <span class="button-text">Export</span>
            </button>
            <button class="btn btn-success" id="live-map-button" type="button" title="Import Live Map Data">
                <i class="fa-solid fa-satellite-dish"></i> <span class="button-text">LIVE</span>
            </button>
            <button class="btn btn-danger" id="clear-all-button" type="button" title="Clear All User Assignments">
                <i class="fa-solid fa-trash"></i>
                 <span class="button-text">Clear</span>
            </button>
        </div>
    </div>

    <div id="alliance-summary">
        <div class="fixed-toggle-container p-1 border-bottom">
            <div class="form-check form-switch">
                <input class="form-check-input mt-1" type="checkbox" role="switch" id="fixed-alliance-toggle" checked>
                <label class="form-check-label small mt-0" for="fixed-alliance-toggle"> Designated War Palace</label>
            </div>
        </div>
        <div class="fixed-toggle-container p-1 border-bottom">
            <div class="form-check form-switch">
                <input class="form-check-input mt-1" type="checkbox" role="switch" id="label-visibility-toggle" checked>
                <label class="form-check-label small mt-0" for="label-visibility-toggle"> Labels</label>
            </div>
        </div>
        <div class="summary-item-container">
        </div>
    </div>


     <div class="modal fade" id="allianceSelectModal" tabindex="-1" aria-labelledby="allianceSelectModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header py-2">
                    <h5 class="modal-title" id="allianceSelectModalLabel">
                        Segment <span id="modalSegmentId" class="fw-bold"></span> - <span id="modalDynamicTitle">Details & Assignment</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="modalCloseButton"></button>
                </div>
                <div class="modal-body py-2">
                    <div class="modal-section" id="modal-section-info">
                         <strong>Segment Information</strong>
                        <div class="row g-2">
                            <div class="col-sm-6">
                                <p class="mb-1 info-group"><strong>Level:</strong> <span id="modalSegmentLevel"></span></p>
                                <p class="mb-1 info-group"><strong>Type:</strong> <span id="modalSegmentName"></span></p>
                            </div>
                            <div class="col-sm-6">
                                <p class="mb-1 info-group"><strong>Buff:</strong> <span id="modalSegmentBuff"></span></p>
                                <p class="mb-1 info-group" id="modalBossInfoContainer"><strong>Boss:</strong> <span id="modalSegmentBoss">N/A</span></p>
                            </div>
                        </div>
                         <div class="row g-2 mt-1">
                            <div class="col-sm-6">
                                <p class="mb-1 info-group" id="modalProdInfoContainer"><strong>Production:</strong> <span id="modalSegmentProd"></span></p>
                            </div>
                            <div class="col-sm-6">
                                <p class="mb-1 info-group" id="modalResistanceInfoContainer"><strong>Resistance:</strong> <span id="modalSegmentResistance"></span></p>
                            </div>
                        </div>
                    </div>
                     <div class="modal-section" id="modal-section-actions">
                         <div class="d-flex justify-content-center gap-2">
                             <button type="button" class="btn btn-warning btn-sm flex-fill" id="mark-conflict-button" title="Mark potential conflict">
                                 <i class="fa-solid fa-triangle-exclamation me-1"></i> Conflict
                             </button>
                             <button type="button" class="btn btn-danger btn-sm flex-fill" id="mark-drop-button" title="Mark as dropped/unwanted">
                                <i class="fa-solid fa-circle-xmark me-1"></i> Drop
                             </button>
                             <button type="button" class="btn btn-secondary btn-sm flex-fill" id="clear-marks-button" title="Clear Conflict/Drop marks">
                                <i class="fa-solid fa-eraser me-1"></i> Clear Marks
                            </button>
                            <button type="button" class="btn btn-secondary btn-sm flex-fill" id="cancel-conflict-selection-button" title="Cancel conflict selection" style="display: none;">
                                <i class="fa-solid fa-ban me-1"></i> Cancel Conflict
                            </button>
                        </div>
                    </div>
                    <div class="border-top pt-2 modal-section" id="modal-section-assignment">
                         <div class="modal-section-header mt-1">Assign Alliance</div>
                         <div id="alliance-buttons" class="d-grid gap-2" style="max-height: 150px; overflow-y: auto;">
                            </div>
                         <button type="button" class="btn btn-outline-secondary w-100 mt-2 btn-sm" id="clear-alliance-button">
                             <i class="fa-solid fa-times-circle me-1"></i> Clear Assignment
                         </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="infoModalLabel">About This Map Tool</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>This interactive map helps coordinate alliance assignments for Season 2 events.</p>
            <h6>How it Works:</h6>
            <ul>
              <li>Click on a map segment to view its details (level, type, buff, production, boss type).</li>
              <li>Assign the segment to an alliance using the buttons in the modal.</li>
              <li>Use the toggles in the sidebar to view fixed War Palace assignments or hide segment labels.</li>
              <li>Mark segments for conflict (<i class="fa-solid fa-triangle-exclamation"></i>) or drop status (<i class="fa-solid fa-circle-xmark"></i>) using the buttons in the segment modal. Conflict marking now uses the alliance buttons for selection.</li>
              <li>The alliance name of the owner is displayed in the bottom-left of the segment.</li>
              <li>The sidebar summarizes alliance progress, resource totals, and buffs. You can pin or collapse alliance summaries.</li>
              <li>Assignments are saved automatically in your browser. Use the <i class="fa-solid fa-trash"></i> button to clear assignments (respects the 'Designated War Palace' toggle).</li>
              <li>Use <i class="fa-solid fa-file-export"></i> (Export) to generate a text code representing the current non-fixed assignments and markers.</li>
              <li>Use <i class="fa-solid fa-file-import"></i> (Import) to load a map state from a previously exported text code.</li>
              <li>Use <i class="fa-solid fa-satellite-dish"></i> (LIVE) to load the current map state from the 'currentmap.txt' file. The button turns green after loading and resets to white if the map is changed.</li>
              </ul>
            <hr>
            <h6>Support Development:</h6>
            <p>If you find this tool helpful, consider supporting its development and maintenance.</p>
            <div id="donate-button-container" class="d-flex justify-content-center">
                <div id="donate-button"></div>
                <script src="https://www.paypalobjects.com/donate/sdk/donate-sdk.js" charset="UTF-8"></script>
                <script>
                PayPal.Donation.Button({
                env:'production',
                hosted_button_id:'W7FS5UKKY5LPY', // Replace with your actual PayPal button ID if needed
                image: {
                src:'https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif',
                alt:'Donate with PayPal button',
                title:'PayPal - The safer, easier way to pay online!',
                }
                }).render('#donate-button');
                </script>
            </div>
          </div>
        </div>
      </div>
    </div>

     <div class="modal fade" id="codeModal" tabindex="-1" aria-labelledby="codeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="codeModalLabel">Map Code</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="codeModalInstructions"></p>
                    <textarea id="codeModalTextarea" class="form-control" rows="8" readonly aria-label="Map Export Code"></textarea>
                    <div id="copyFeedback" class="mt-2 text-success" style="display: none;">Code copied successfully!</div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="copyCodeButton">
                         <i class="fa-regular fa-copy me-1"></i>Copy Code
                    </button>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src='https://cdn.jsdelivr.net/npm/@panzoom/panzoom@4.5.1/dist/panzoom.min.js'></script>
    <script src="S2mapscript.js"></script>
</body>
</html>