<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Applicant Information</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for a clean, professional font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Use Inter as the default font for a clean look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0c0c14; /* Very dark blue/purple */
            /* Subtle noise texture for the background */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='4' viewBox='0 0 4 4'%3E%3Cpath fill='%23ffffff' fill-opacity='0.03' d='M1 3h1v1H1V3zm2-2h1v1H3V1z'%3E%3C/path%3E%3C/svg%3E");
        }
        .header-glow {
            color: #67e8f9; /* light cyan */
            text-shadow: 0 0 8px rgba(34, 211, 238, 0.4), 0 0 12px rgba(34, 211, 238, 0.2);
        }
        .container-glow {
            box-shadow: 0 0 25px rgba(34, 211, 238, 0.1), inset 0 0 10px rgba(34, 211, 238, 0.1);
        }
    </style>
</head>
<body class="antialiased text-slate-300">

    <div class="container mx-auto p-3 sm:p-5 lg:p-6">
        <header class="mb-6">
            <h1 class="text-2xl sm:text-3xl font-bold header-glow">Applicant Data</h1>
            <p class="mt-2 text-sm text-cyan-400/80">Live data feed from source.</p>
        </header>

        <!-- Container for the table with a loading state -->
        <div id="table-container" class="bg-slate-900/50 border border-cyan-500/20 rounded-xl overflow-hidden container-glow">
            <!-- Loading State -->
            <div id="loading-state" class="p-6 text-center text-slate-400">
                <svg class="animate-spin h-8 w-8 text-cyan-500 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="text-base font-medium">Loading data, please wait...</p>
            </div>
            <!-- This is where the table will be injected -->
        </div>
        <footer class="text-center mt-6 text-xs text-slate-500">
            <p>Data is automatically updated from the source.</p>
        </footer>
    </div>

    <script>
        // The CSV URL from your Google Sheet
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRrI4LGHV2H2EWNBziVpx6T8jZ-VxYKfRXykxBw1l16KN23ogQuPou3H_0Xx_UwAcBGBk4x3qN4bag1/pub?output=csv';

        // --- Core Application Logic ---

        /**
         * Fetches and parses CSV data from the published Google Sheet.
         */
        async function fetchSheetData() {
            const tableContainer = document.getElementById('table-container');
            const loadingState = document.getElementById('loading-state');

            try {
                const response = await fetch(csvUrl);
                if (!response.ok) throw new Error(`Network response was not ok (status: ${response.status})`);
                const csvText = await response.text();
                
                const lines = csvText.trim().split(/\r?\n/);
                const headers = lines[0].split(',').map(header => header.trim());
                const data = lines.slice(1).map(line => {
                    const values = line.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g)
                                     .map(value => value.replace(/"/g, '').trim());
                    let entry = {};
                    headers.forEach((header, i) => {
                        entry[header] = values[i] || '';
                    });
                    return entry;
                });

                loadingState.style.display = 'none';
                displayData(headers, data);

            } catch (error) {
                console.error('Error fetching or parsing data:', error);
                loadingState.style.display = 'none';
                tableContainer.innerHTML = `
                    <div class="p-8 text-center bg-red-900/50 text-red-300 rounded-xl">
                        <h3 class="font-bold text-lg">Error: Failed to load data</h3>
                        <p class="mt-2 text-md">Please check the Google Sheet URL and your internet connection.</p>
                    </div>`;
            }
        }

        /**
         * Returns text and color class for a given seat.
         */
        function getSeatStyle(position = '') {
            const p = position.toLowerCase();
            if (p.includes('gold')) return { text: 'Gold', colorClass: 'text-amber-400' };
            if (p.includes('purple')) return { text: 'Purple', colorClass: 'text-purple-400' };
            if (p.includes('blue')) return { text: 'Blue', colorClass: 'text-blue-400' };
            return { text: position, colorClass: 'text-slate-300' }; // Default
        }
        
        /**
         * Returns Tailwind CSS classes for a status badge.
         */
        function getStatusBadge(status = '') {
            const s = status.toLowerCase();
            let classes = 'bg-slate-700 text-slate-200'; // Default
            if (s.includes('interviewing')) classes = 'bg-cyan-500/20 text-cyan-300';
            if (s.includes('hired')) classes = 'bg-green-500/20 text-green-300';
            if (s.includes('offer')) classes = 'bg-yellow-500/20 text-yellow-300';
            if (s.includes('rejected')) classes = 'bg-red-500/20 text-red-400';
            return `<span class="inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-semibold ${classes}">${status}</span>`;
        }

        /**
         * Renders the fetched data into a responsive Tailwind CSS table.
         */
        function displayData(headers, data) {
            const tableContainer = document.getElementById('table-container');
            if (!data.length) {
                tableContainer.innerHTML = `<div class="p-8 text-center text-slate-400"><p>No data available to display.</p></div>`;
                return;
            }
            
            // Define which headers to hide
            const hiddenHeaders = ['timestamp', 'bringing players?', 'member details'];
            
            // Get the header names for the name and position columns by index
            // This is more robust than searching for strings.
            const playerNameHeader = headers[1]; // "Player Name" is the 2nd column (index 1)
            const positionHeader = headers[4]; // "Position Applied For" is the 5th column (index 4)


            let tableHTML = `
                <div class="overflow-x-auto">
                    <table class="w-full text-xs text-left text-slate-400">
                        <thead class="text-[11px] text-cyan-300/80 uppercase bg-slate-800/50">
                            <tr>`;
            
            headers.forEach(header => {
                if (!hiddenHeaders.includes(header.toLowerCase())) {
                    tableHTML += `<th scope="col" class="px-5 py-3 font-semibold tracking-wider">${header}</th>`;
                }
            });

            tableHTML += `</tr></thead><tbody>`;

            data.forEach(row => {
                tableHTML += `<tr class="border-b border-slate-700/50 hover:bg-slate-800/50 transition-colors duration-200">`;
                
                // Determine the seat style based on the value in the "Position Applied For" column
                const seatStyle = getSeatStyle(row[positionHeader]);

                headers.forEach(header => {
                    if (!hiddenHeaders.includes(header.toLowerCase())) {
                        const cellData = row[header] || '';
                        
                        // Check if the current header is the Player Name header
                        if (header === playerNameHeader) {
                            // Apply the seat color to the player's name
                            tableHTML += `<td class="px-5 py-3 font-bold ${seatStyle.colorClass}">${cellData}</td>`;
                        } else if (header === positionHeader) {
                            // Display the simplified seat text (e.g., "Gold") without special color
                            tableHTML += `<td class="px-5 py-3 font-medium text-slate-300">${seatStyle.text}</td>`;
                        } else if (header.toLowerCase().includes('status')) {
                             tableHTML += `<td class="px-5 py-3">${getStatusBadge(cellData)}</td>`;
                        } else if (header.toLowerCase().includes('email')) {
                            tableHTML += `<td class="px-5 py-3"><a href="mailto:${cellData}" class="text-cyan-400 hover:text-cyan-300 hover:underline">${cellData}</a></td>`;
                        } else {
                            // Default cell for other data
                            tableHTML += `<td class="px-5 py-3 font-medium text-slate-300">${cellData}</td>`;
                        }
                    }
                });
                tableHTML += `</tr>`;
            });

            tableHTML += `</tbody></table></div>`;
            
            tableContainer.innerHTML = tableHTML;
        }

        // Run the script after the webpage's content has fully loaded
        document.addEventListener('DOMContentLoaded', fetchSheetData);
    </script>

</body>
</html>
